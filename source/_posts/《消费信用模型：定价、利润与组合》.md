---
title: 《消费信用模型：定价、利润与组合》 - 读书笔记
date: 2023-11-28 22:35:12
categories: [Economics&Finance, RiskControl]
tags: [credit, decision, economics]
---

# 前言

本书集合了当前信用研究和应用面临的主要问题，从三大挑战——定价（ pricing ）、利润（ profit ）与组合（ portfolio ）出发，进行了详细的探讨和论述。

这些贷款机构在零售贷款中遇到的新问题三个主要的变化趋势是：

- 贷款机构如何根据违约风险差异化定价。

- 贷款机构如何把违约评分变成利润评分。
- 如何不仅对单个贷款风险进行评估，还对贷款组合的风险进行评估。

# 1 消费信用和信用评分简介

## 1.1 引言：消费信用的重要性和影响力

讲述信用的起源，给出消费信用贷款增长数据证明消费信用的重要性和影响力。

## 1.2 违约信用评分的历史背景

- 申请评分 - A卡

  信用评分技术诞生于 20 世纪 50 年代，当时的学者认识到用来分类的**统计学方法**可以用来区分贷款的好坏。最初的信用评分应用于是否给新的申请者发放贷款（贷前评分 - 申请评分）。做法是贷款机构从以往的申请者（已知好坏）那里获取数据，建立模型，把新的申请者按违约风险高低排序。

  这里也提到了最常见的风险（坏客户定义）是申请者在获得贷款后 12 个月内出现 90 天及以上的逾期，**这个只是坏客户定义的一种**。

  根据这样的坏客户定义得到的模型分数，讲究**排序正确**。并提到接受申请者的合格分数（准入分数）是较为主观的选择，要权衡各项业务指标如期望利润、期望损失和市场份额等。

- 行为评分 - B卡

  行为评分技术诞生于 20 世纪 80 年代早期，是申请评分的延伸（因为它发生于一笔贷款确定放贷开始之后，行为评分 - 贷中评分）。着眼于申请者的动态表现，而不单单是申请时的静态特征。

## 1.3 贷款机构的目标

### 1.3.1 银行的目标

主要目标之一是让贷款带来最多的利润，对于同样的本金利润更高，也就是需要利润率最优。
$$
profit\% = \frac{profit}{principal}
$$
另一个目标是将贷款组合（可以理解为多笔贷款的组合）的风险回报控制在可接受的范围内。

第三个目标是扩大贷款组合的规模。

### 1.3.2贷款过程

- 获得资金

  通过多种途径获得资金：投资人、股东；向其他金融机构借；向储户借；用活期存款支付给储户合适的利率获得资金使用权。

- 建立消费贷款组合

  找到借款人，管理这个贷款组合，让它产生合理的利润，使得扣除资金融资成本和其他开支后还有回报。

> 这里提到了风险定价的概念，风险定价是指利用风险信息给贷款定价（贷款利率），以增加利润。**这里定价指的是定利率而不是额度。**
>
> 这里也提到了利润评分重点在于**估计从借款人（ borrower ）那里可能获得的现金流**，进而估计借款人的期望价值，找到可以预测借款人利润率的因素，以及提高这一利润率的决策方式。

## 1.4 贷款决策的建模工具

银行借钱给客户，无论是给新申请者的信用卡、按揭贷款、个人消费贷款，还是在现有基础上提高信用额度，**本质上都是决策问题**。这里主要介绍了**影响图（ influence diagram ）**和**决策树（ decision tree ）**两种工具。

### 1.4.1 影响图

> [Influence diagram - Wikipedia](https://en.wikipedia.org/wiki/Influence_diagram)

一张影响图由三类节点（ node ）组成，之间由线（ arc ）连接。三类节点是：

- 决策（ 用矩形表示 ）
- 随机事件（ 用圆圈表示 ）
- 结果（ 用菱形表示 ）

如果某个决策或随机事件 X 对另一个决策、随机事件或结果 Y 会产生影响，就画一条 X 指向 Y 的弧线箭头，表示 X 影响 Y 。当 Y 的节点不同时，具有以下三种不同的含义。

-  Y 是一个决策，那么 X 中所包含的信息可能会改变这个决策。
-  Y 是一个随机事件，那么条件概率 $P(Y|X)$ 和非条件概率 $P(Y)$ 并不相同。
-  Y 是一个结果，那么说明该结果受到了 X 的影响。

### 1.4.2 消费信贷中的申请决策影响图

![消费信贷中的申请决策影响图](https://movis-blog.oss-cn-chengdu.aliyuncs.com/img/%E6%A0%87%E5%87%86%E6%B6%88%E8%B4%B9%E4%BF%A1%E8%B4%B7%E7%9A%84%E5%BD%B1%E5%93%8D%E5%9B%BE.png)

### 1.4.3 决策树

> [Decision tree - Wikipedia](https://en.wikipedia.org/wiki/Decision_tree)

决策树中同样有三种类型的节点：

- 决策（用矩形表示）
- 随机事件（用圆圈表示）
- 回报（ pay off ，用每条路径末端的数值表示）

**值得注意的是，在决策树中左边的决策或事件比右边的决策或事件先发生。正是有了这种先后关系，才不需要箭头了。**

### 1.4.4 消费信贷决策树

![消费信贷决策树](https://movis-blog.oss-cn-chengdu.aliyuncs.com/img/%E6%A0%87%E5%87%86%E6%B6%88%E8%B4%B9%E4%BF%A1%E8%B4%B7%E7%9A%84%E5%86%B3%E7%AD%96%E6%A0%91.png)

假设借款人接受贷款概率 $q$ 暂不影响决策。接受申请的条件是申请者的预测风险 $X$ （ $X$ 可能为高也可能为低）满足：
$$
p(X)g+(1-p(X))(-l)>0
$$
如果要考虑接受贷款的概率 $q$ 与每笔贷款的贷前管理费用 $c$ ，那么接受申请的条件变为：
$$
q[p(X)g+(1-p(X))(-l)]>c
$$

核心就是**利润包括借款人还款情况好时的盈利和还款情况坏时的损失**。

### 1.4.5 策略树

贷款过程中的决策有很多，比如是否营销，是否授信，是否催收等等，其中有的决策里一种选择实际上就是终点，而另一种选择则只是决策的一个过程，比如不营销就没有后文了，是决策终点，而选择营销后还存在授信，催收等等决策。策略树就是整个策略的生命周期。

## 1.5 概率、比率和分数

### 1.5.1 概率和比率

提到了三种相互关联的方法来描述好借款人（A 卡一般是用还款差作为标签 1 的定义，这里是用还款好作为标签 1 的定义）的可能性：

- 事件发生的概率（ probability ） $P(good)$ 。
- 事件发生的比率（ odds ，好坏比） $odds=\frac{P(good|x)}{P(bad|x)}$ 。
- 包含了估计事件发生比率的所需信息的分数（ score ）或指数（ index ）。

### 1.5.2 总体比率和信息比率

**这里很重要地提到了分离了总体比率和信息比率的概念，当总体样本好坏比发生变化时，信息比率不变，总体比率会变。**我的理解是提到了信息比率可以用来带来排序，而并不会受行情影响。对于贷款来讲，行情变坏时，仅能保持排序不变。

**证据权重 WOE （ weights of evidence）的公式为：**
$$
WOE=ln(odds)=ln(\frac{P(good|x)}{P(bad|x)})
$$
相较于原始总体比率，证据权重是具有信息 x 或分数 s 的人群的好人比率的对数。WOE 为正表明这个组的好人概率比全部总体要好；若为负，则表明这组比总体要差一些。

### 1.5.3 分数：一个充分统计量

上面提到的信息比率是针对特征来讲的，这里的分数则是针对模型来讲的，这样做的目的是将向量（一个样本的多个特征）转化为标量（可以理解为是好人的概率）。

### 1.5.4 对数比率分数

如果是好人的绝对概率是 p ，那么对数比率分数是：
$$
Score_{log}=ln\frac{p}{1-p} 
$$
这样做可以提高比较极端的人的差异，证明如下：

假设 9 个人的好人概率分别为 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9，他们每个人和下一个人的差异是恒定的 0.1，如果是取对数比率分数的话，就变成了 -2.1972, -1.3863, -0.8473, -0.4055, 0.0, 0.4055, 0.8473, 1.3863, 2.1972，可以看到左右两端的人和下一个人的差异是比较大的，而中间的人差异比较小。

### 1.5.5 对数比率分数的分解

这里提到单特征的 woe 不随总体好坏比变化而变化，感觉指的是没有从总体好坏变化中得到额外信息，是样本估计总体的思想。既然 woe 没变，而总体对数评分变好了，所以某个特征的某个值的对数评分就会变高。

这是因为某个特征的某个值的对数比率分数公式为：
$$
Score_{log\ in\ x}=Score_{log\_pop}+woe_{x}
$$

### 1.5.6 朴素 Bayes 评分卡的构建

由上面单特征取值对对数比率分数的影响，**在假设特征相互独立的前提下**，根据 Bayes 定理可得：
$$
Score_{log}=Score_{log\_pop}+(woe_{x1}+woe_{x2}+...+woe_{xn})
$$
这个分数根据 sigmoid 函数也可以转换为借款人是好人的概率，公式为：
$$
P(good)=\frac{1}{1+e^{-Score_{log}}}
$$
但是由于特征实际上并不是相互独立的，所以这个方法不够稳健。

### 1.5.7 分数分布

这里提到了好坏的分布很重要，可以通过条件分布函数将本是离散的分数（因为特征分箱导致的取值数量有限）变成连续的，从而简化分数的计算。

## 1.6 分数的变换

这节主要介绍了分数的几种变换和延展的方法。

### 1.6.1 缩放自然分数

回首对数分数的公式：
$$
Score = ln(\frac{p}{1-p})
$$
很显然假设 p 小于 0.5，也就是好人的概率小于坏人的概率，这个分数就是负的。同时，这个分数总体而言量级比较小，观感略差，因此对这个分数做线性变换就得到了缩放的自然分数：
$$
Score_{scaled}=A+B\times Score_{original}
$$
这时问题就变成了 A，B 怎么求得。这里其实有两种思路。

第一种，想好某两个不同分数的好人概率，把 A，B 当作未知数去求一个二元一次方程组，解得 A，B。

第二种，把 A 作为一个基准分直接给定数值，然后想好每增加多少分好坏比（或者好人概率）翻倍，实质上是把 B 当作未知数去求一个一元一次方程。

### 1.6.2 缩放正态分布的分数

假设好人和坏人的分数分布是正态的，那么概率密度函数为：
$$
f(x)=\frac{1}{\sqrt{2\pi}\sigma}e^{-\frac{(x-\mu)^{2}}{2\sigma ^{2}}}
$$
再假设好人和坏人的方差是相同的，可以得到：
$$
WOE=ln(\frac{f(Score|Good)}{f{Score|Bad}})=-\frac{\mu_{G}^{2}-\mu_{B}^{2}}{2\sigma^{2}}+\frac{\mu_{G}-\mu_{B}}{\sigma^{2}}\times Score
$$
那么缩放的正态分布的分数可以表示为：
$$
S_{scaled}=(ln\frac{P_{G}}{P_{B}}-\frac{\mu_{G}^{2}-\mu_{B}^{2}}{2\sigma^{2}})+\frac{\mu_{G}-\mu_{B}}{\sigma^{2}}\times Score
$$
这种形式。

### 1.6.3 多级评分卡

在有多个数据源的情况下，或者说有多级数据源的情况下（指有的数据能够先获取，有的数据后获取），常规方法是合并多个数据源，直接用所有特征来建立模型。

不过根据分数包含了所有评估风险的信息这个性质，可以直接把第一级数据源所建立模型的分数作为第二级数据源模型的特征，有点类似 Stacking 的操作。

### 1.6.4 风险率和时变分数

这里简单提了下考虑借款人变坏的时间问题。

### 1.6.5 离散时间风险概率

考虑了不同时间违约带来的不同影响问题，为引入 LGD 做铺垫。

## 1.7 贷款的回收和成本

### 1.7.1 单期贷款的回报率模型

在放款受益大于无风险投资收益时，应该放贷：
$$
P_{G}\times (1+r)+P_{B}\times(1-l_{LGD})>1+r_{F}
$$
又因为：
$$
P_{B} = 1-P_{G}
$$
可以求得：
$$
p>\frac{r_{F}+l_{LGD}}{r+l_{LGD}}\\
或\\
r>\frac{r_{F}+(1-p)\times l_{LGD}}{p}
$$

### 1.7.2 单期企业债券的回报率模型

### 1.7.3 消费贷款的利润率和回报率

用单期贷款回报率模型为基础，可以理解为贷款机构以无风险利率 $r_{F}$ 筹钱之后再以 $r$ 的利率借出去，这时假设筹钱的利率不是 $r_{F}$ ，可以用 $r_{B}$ 替代 $r_{F}$ 。 

### 1.7.4 两期回报率模型



### 1.7.5 多期贷款

## 1.8 评分卡构建的基本原理

### 1.8.1 建立评分卡的基本方法

### 1.8.2 拒绝推断

### 1.8.3 行为评分

### 1.8.4 数据样本

### 1.8.5 数据检验和整理

### 1.8.6 样本细分

### 1.8.7 训练和检验样本

### 1.8.8 剔除特征变量

### 1.8.9 特征粗分类

### 1.8.10 卡方和信息统计量

### 1.8.11 粗分类生成新变量

### 1.8.12 评分卡最终形成和检验

## 1.9 逻辑回归评分卡

## 1.10 其他建立评分卡的方法

### 1.10.1 线性回归

### 1.10.2 散度最大化

### 1.10.3 线性规划

### 1.10.4 分类树

# 2 评分系统的评估

## 2.1 评分卡质量的评估

### 2.1.1 交叉验证法

### 2.1.2 自展法

## 2.2 判别能力的测量

### 2.2.1 散度与信息量

### 2.2.2 马氏距离

### 2.2.3 KS 统计量

### 2.2.4 D 一致性统计量与 U 统计量

## 2.3 ROC 曲线和 Gini 系数

### 2.3.1 Gini 系数和 AUROC

### 2.3.2 ROC 曲线与 D 统计量、KS统计量的关系

### 2.3.3 Gini 系数的边界

### 2.3.4 ROC 曲线和商业决策

### 2.3.5 CAP 曲线与准确率

## 2.4 评分卡细分对判别能力的影响

### 2.4.1 样本细分对 Gini 系数的影响

### 2.4.2 样本细分对 KS 统计量的影响

### 2.4.3 样本细分对散度的影响

## 2.5 评分卡预测概率的校准

### 2.5.1 二项检验

### 2.5.2 二项检验的正态近似

### 2.5.3 卡方检验

## 2.6 分类预测正确程度的衡量

### 2.6.1 混淆矩阵

### 2.6.2 第一类错误和第二类错误，敏感度和特异度

### 2.6.3 交换集合

### 2.6.4 最小错误成本

# 3 基于风险定价

## 3.1 消费信贷中的可变定价

### 3.1.1 可变定价

### 3.1.2 差异化定价

### 3.1.3 响应率和接受率

## 3.2 无风险利率响应函数和最优定价

### 3.2.1 无风险响应率

### 3.2.2 弹性

### 3.2.3 最大支付意愿

### 3.2.4 常见的响应函数

### 3.2.5 最优定价

## 3.3 风险响应关系，逆向选择和负担能力

### 3.3.1 风险响应关系

### 3.3.2 逆向选择

### 3.3.3 风险响应关系和逆向选择的区别

### 3.3.4 负担能力

## 3.4 基于风险的响应函数和定价

### 3.4.1 基于风险的好人概率

### 3.4.2 基于风险的最优利率

### 3.4.3 无逆向选择的最优利率

### 3.4.4 有逆向选择的最优利率

## 3.5 多种优惠条件下的接受概率

### 3.5.1 贷款的多种优惠条件

### 3.5.2 逻辑接受概率函数

### 3.5.3 线性规划估计最大支付意愿

### 3.5.4 加速生命模型估计最大支付意愿

## 3.6 借贷博弈定价模型

# 4 利润评分和动态模型

## 4.1 行为评分和账户动态管理

### 4.1.1 账户管理和利润率

### 4.1.2 行为分数

## 4.2 利润评分和风险回报矩阵

### 4.2.1 客户层面和产品层面的评分

### 4.2.2 风险回报矩阵

### 4.2.3 风险回报矩阵里的最优策略

### 4.2.4 消费行为的动态估计

## 4.3 账户行为的 Markov 链模型

### 4.3.1 Markov 链的定义

### 4.3.2 消费信用中的 Markov 链模型

### 4.3.3 Markov 链的参数估计和假设检验

### 4.3.4 Markov 链模型的延伸

## 4.4 Markov 的利润率决策模型

## 4.5 生存分析的违约评分系统

### 4.5.1 何时违约

### 4.5.2 生存分析

### 4.5.3 比例风险模型

### 4.5.4 Cox 比例风险模型

### 4.5.5 建立比例风险模型

### 4.5.6 比例风险行为分数

## 4.6 生存分析利润模型

### 4.6.1 生存分析计算利润率

### 4.6.2 风险竞争

# 5 组合信用风险和巴塞尔协议

## 5.1 组合信用风险

### 5.1.1 组合层面的度量

### 5.1.2 组合层面的违约概率

### 5.1.3 违约损失率和组合层面的损失

##  5.2 经济和监管资本

### 5.2.1 资产和负债

### 5.2.2 贷款中的风险

### 5.2.3 监管和经济资本

## 5.3 巴塞尔资本协议概述

### 5.3.1 历史

### 5.3.2 期望损失、意外损失、监管资本和在险价值

### 5.3.3 组合不变性

### 5.3.4 巴塞尔模型中的监管资本

### 5.3.5 消费信用的巴塞尔方程

### 5.3.6 小结

## 5.4 巴塞尔新资本协议对信用评分的影响

### 5.4.1 三角关系

### 5.4.2 违约的定义

### 5.4.3 时点和周期违约概率

### 5.4.4 校准

### 5.4.5 消费贷款中的企业信用模型

### 5.4.6 违约暴露

### 5.4.7 违约损失率

## 5.5 监管资本和最优临界分数

### 5.5.1 个人贷款接受决策的建模

### 5.5.2 给定股权资本的组合最优临界分数

### 5.5.3 可变股权资本的组合最优临界分数

### 5.5.4 巴塞尔协议对 ROC 曲线的影响

## 5.6 消费和企业贷款组合的信用风险建模

### 5.6.1 企业信用模型的发展

### 5.6.2 基于信誉的消费结构模型

### 5.6.3 基于负担能力的消费结构模型

### 5.6.4 基于风险函数的消费简约模型

### 5.6.5 基于 Markov 链的消费简约模型

## 5.7 消费信贷组合的压力测试

### 5.7.1 巴塞尔协议中的压力测试

### 5.7.2 敏感分析和情景分析

### 5.7.3 违约概率的静态压力测试方法

### 5.7.4 动态相关模型

### 5.7.5 基于模型的动态方法

### 5.7.6 LGD 和 EAD 的压力测试

