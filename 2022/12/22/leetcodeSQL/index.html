

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/logo.jpg">
  <link rel="icon" href="/img/logo.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#414142">
  <meta name="author" content="MovisLi">
  <meta name="keywords" content="ComputerScience, DataScience, Economics&amp;Finance, Management">
  
    <meta name="description" content="SQL 入门 选择 595. 大的国家 简单的条件筛选。 SELECT     name,     population,     area FROM     World WHERE     area &gt;&#x3D; 3000000     OR population &gt;&#x3D; 25000000; 1757. 可回收且低脂的产品 也是简单的条件筛选。 SELECT     produc">
<meta property="og:type" content="article">
<meta property="og:title" content="「SQL」 - 学习计划">
<meta property="og:url" content="https://movisli.github.io/2022/12/22/leetcodeSQL/index.html">
<meta property="og:site_name" content="movis">
<meta property="og:description" content="SQL 入门 选择 595. 大的国家 简单的条件筛选。 SELECT     name,     population,     area FROM     World WHERE     area &gt;&#x3D; 3000000     OR population &gt;&#x3D; 25000000; 1757. 可回收且低脂的产品 也是简单的条件筛选。 SELECT     produc">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-12-21T16:35:58.000Z">
<meta property="article:modified_time" content="2024-06-07T08:32:58.968Z">
<meta property="article:author" content="MovisLi">
<meta property="article:tag" content="SQL">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>「SQL」 - 学习计划 - movis</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"movisli.github.io","root":"/","version":"1.9.0","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":false,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Movis</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="「SQL」 - 学习计划"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        MovisLi
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-12-22 00:35" pubdate>
          December 22, 2022 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          9k words
        
      </span>
    

    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;Table of Contents</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">「SQL」 - 学习计划</h1>
            
            <div class="markdown-body">
              
              <h1 id="sql-入门">SQL 入门</h1>
<h2 id="选择">选择</h2>
<h3 id="大的国家">595. 大的国家</h3>
<p>简单的条件筛选。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    name,
    population,
    area
FROM
    World
WHERE
    area &gt;= 3000000
    OR population &gt;= 25000000;</code></pre></div>
<h3 id="可回收且低脂的产品">1757. 可回收且低脂的产品</h3>
<p>也是简单的条件筛选。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    product_id
FROM
    Products
WHERE
    low_fats = &#x27;Y&#x27;
    AND recyclable = &#x27;Y&#x27;;</code></pre></div>
<h3 id="寻找用户推荐人">584. 寻找用户推荐人</h3>
<p>这道题注意 <code>!=</code> , <code>=</code> , <code>&gt;</code> ,
<code>&lt;</code> 这些会忽略 <code>NULL</code> ，让结果中没有
<code>NULL</code> 。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    name
FROM
    customer
WHERE
    referee_id != 2
    OR referee_id IS NULL;</code></pre></div>
<h3 id="从不订购的客户">183. 从不订购的客户</h3>
<p>子查询：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    Name AS Customers
FROM
    Customers
WHERE
    Id NOT IN (
        SELECT DISTINCT CustomerId FROM Orders
    );</code></pre></div>
<p>左连接：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    Name AS Customers
FROM
    Customers
    LEFT JOIN Orders ON Customers.Id = Orders.CustomerId
WHERE
    Orders.CustomerId IS NULL;</code></pre></div>
<h2 id="排序-修改">排序 &amp; 修改</h2>
<h3 id="计算特殊奖金">1873. 计算特殊奖金</h3>
<p>两次查询结果合并， <code>UNION+WHERE</code> ：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    employee_id,
    salary AS bonus
FROM
    Employees
WHERE
    employee_id &amp; 1
    AND name NOT LIKE &#x27;M%&#x27;
UNION
SELECT
    employee_id,
    0 AS bonus
FROM
    Employees
WHERE
    employee_id &amp; 1 != 1
    OR name LIKE &#x27;M%&#x27;
ORDER BY
    employee_id ASC;</code></pre></div>
<p>MySQL 中有个函数 LEFT 也可以：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    employee_id,
    salary AS bonus
FROM
    Employees
WHERE
    employee_id &amp; 1
    AND LEFT(name, 1) != &#x27;M&#x27;
UNION
SELECT
    employee_id,
    0 AS bonus
FROM
    Employees
WHERE
    employee_id &amp; 1 != 1
    OR LEFT(name, 1) = &#x27;M&#x27;
ORDER BY
    employee_id ASC;</code></pre></div>
<p>CASE WHEN 也可以：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    employee_id,
    (CASE WHEN employee_id&amp;1 AND LEFT(name, 1) != &#x27;M&#x27; THEN salary ELSE 0 END) AS bonus
FROM
    Employees
ORDER BY
    employee_id ASC;</code></pre></div>
<p>IF 也可以：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    employee_id,
    IF(employee_id&amp;1 AND LEFT(name, 1) != &#x27;M&#x27;, salary, 0) AS bonus
FROM
    Employees
ORDER BY
    employee_id ASC;</code></pre></div>
<h3 id="变更性别">627. 变更性别</h3>
<p>IF 函数：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">UPDATE
    Salary
SET
    sex=IF(sex=&#x27;m&#x27;, &#x27;f&#x27;, &#x27;m&#x27;);</code></pre></div>
<p>CASE WHEN 语句：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">UPDATE
    Salary
SET
    sex=(CASE sex WHEN &#x27;m&#x27; THEN &#x27;f&#x27; ELSE &#x27;m&#x27; END);</code></pre></div>
<p>还有个 ASCII 码于字符转换的方法：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">UPDATE
    Salary
SET
    sex=CHAR(109+102-ASCII(sex));</code></pre></div>
<h3 id="删除重复的电子邮箱">196. 删除重复的电子邮箱</h3>
<p>自连接：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">DELETE 
    p1
FROM
    Person AS p1,Person AS p2
WHERE
    p1.id &gt; p2.id
    AND p1.email = p2.email;</code></pre></div>
<h2 id="字符串处理函数正则">字符串处理函数/正则</h2>
<h3 id="修复表中的名字">1667. 修复表中的名字</h3>
<p>CONCAT, UPPER, LOWER, LEFT, SUBSTRING 这几个函数的用法。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    user_id,
    CONCAT(UPPER(LEFT(name,1)), LOWER(LOWER(SUBSTRING(name, 2)))) AS name
FROM
    Users
ORDER BY
    user_id ASC;</code></pre></div>
<h3 id="按日期分组销售产品">1484. 按日期分组销售产品</h3>
<p>刷 SQL 我怎么感觉算是刷 SQL 函数的使用。这道题是讲 GROUP_CONCAT
这个函数：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">GROUP_CONCAT(DISTINCT expression
    ORDER BY expression
    SEPARATOR sep);</code></pre></div>
<p>还有就是 COUNT 这个函数括号里可以有 DISTINCT 。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    sell_date,
    COUNT(DISTINCT product) AS num_sold,
    GROUP_CONCAT(DISTINCT product ORDER BY product ASC SEPARATOR &#x27;,&#x27;) AS products
FROM
    Activities
GROUP BY
    sell_date
ORDER BY
    sell_date ASC;</code></pre></div>
<h3 id="患某种疾病的患者">1527. 患某种疾病的患者</h3>
<p>LIKE 的用法，两种情况：</p>
<ul>
<li>第一个元素以 <code>DIAB1</code> 开头，对应 <code>'DIAB1%'</code>
。</li>
<li>非第一个元素以 <code>DIAB1</code> 开头，对应 <code>'% DIAB1%'</code>
。</li>
</ul>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    patient_id,
    patient_name,
    conditions
FROM
    Patients
WHERE
    conditions LIKE &#x27;DIAB1%&#x27;
    OR conditions LIKE &#x27;% DIAB1%&#x27;;</code></pre></div>
<h2 id="组合查询-指定选取">组合查询 &amp; 指定选取</h2>
<h3 id="丢失信息的雇员">1965. 丢失信息的雇员</h3>
<p>MySQL 居然没有 FULL OUTER JOIN ，所以我们可以使用 LEFT JOIN 加 RIGHT
JOIN 这种方式实现。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    t1.employee_id
FROM
    Employees AS t1
    LEFT JOIN Salaries AS t2 ON t1.employee_id = t2.employee_id
WHERE
    t2.salary IS NULL
UNION
SELECT
    t2.employee_id
FROM
    Employees AS t1
    RIGHT JOIN Salaries AS t2 ON t1.employee_id = t2.employee_id
WHERE
    t1.name IS NULL
ORDER BY
    employee_id ASC;</code></pre></div>
<p>可以用 GROUP BY 的方式实现，讲两张表的 <code>employee_id</code> UNION
ALL（与 UNION 的区别就是不去重）起来，计数等于 1 的
<code>employee_id</code> 就是信息缺失的。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    t.employee_id
FROM
    (
        SELECT employee_id FROM Employees
        UNION ALL
        SELECT employee_id FROM Salaries
    ) AS t
GROUP BY
    t.employee_id
HAVING
    COUNT(t.employee_id) = 1
ORDER BY
    t.employee_id ASC;</code></pre></div>
<h3 id="每个产品在不同商店的价格">1795. 每个产品在不同商店的价格</h3>
<p>列转行问题，可以用 UNION ALL （这里不会重复，这里主要是比 UNION
快）。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT product_id, &#x27;store1&#x27; AS store, store1 AS price FROM Products WHERE store1 IS NOT NULL
UNION ALL
SELECT product_id, &#x27;store2&#x27; AS store, store2 AS price FROM Products WHERE store2 IS NOT NULL
UNION ALL
SELECT product_id, &#x27;store3&#x27; AS store, store3 AS price FROM Products WHERE store3 IS NOT NULL;</code></pre></div>
<h3 id="树节点">608. 树节点</h3>
<p>感觉很多 SQL
的题考察的都是对这门语言的熟练程度而不是逻辑，比如这道题的逻辑很简单，就是：</p>
<ul>
<li><code>p_id</code> 为空， Root</li>
<li><code>p_id</code> 不为空 <code>id</code> 不是别人的
<code>p_id</code> ，Leaf</li>
<li><code>p_id</code> 不为空 <code>id</code> 是别人的 <code>p_id</code>
，Inner</li>
</ul>
<p>CASE WHEN ELSE 语句：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    id,
    CASE
        WHEN p_id IS NULL THEN &#x27;Root&#x27;
        WHEN id NOT IN (SELECT p_id FROM tree WHERE p_id IS NOT NULL) THEN &#x27;Leaf&#x27;
        ELSE &#x27;Inner&#x27;
    END AS Type
FROM
    tree
ORDER BY
    id;</code></pre></div>
<p>IF 语句：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    id,
    IF(p_id IS NULL, &#x27;Root&#x27;, IF(id NOT IN (SELECT p_id FROM tree WHERE p_id IS NOT NULL), &#x27;Leaf&#x27;, &#x27;Inner&#x27;)) AS Type
FROM
    tree
ORDER BY
    id;</code></pre></div>
<h3 id="第二高的薪水">176. 第二高的薪水</h3>
<p>除开最高薪水的最高薪水：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    MAX(salary) AS SecondHighestSalary
FROM
    Employee
WHERE
    salary != (
        SELECT MAX(salary) FROM Employee
    );</code></pre></div>
<p>从大到小排序去重后排第二的薪水：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT (
    SELECT DISTINCT
        salary
    FROM
        Employee
    ORDER BY
        salary DESC
    LIMIT 1 OFFSET 1
) AS SecondHighestSalary;</code></pre></div>
<h2 id="合并">合并</h2>
<h3 id="组合两个表">175. 组合两个表</h3>
<p>简单的连接，注意要包含 <code>Person</code> 表的信息即可。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    t1.firstName,
    t1.lastName,
    t2.city,
    t2.state
FROM
    Person AS t1
    LEFT JOIN Address AS t2 ON t1.personId = t2.personId;</code></pre></div>
<h3 id="进店却未进行过交易的顾客">1581. 进店却未进行过交易的顾客</h3>
<p>首先查满足条件的 <code>customer_id</code> ，然后再用 GROUP BY
进行统计。以构建一张中间表的形式在 FROM 里：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    customer_id,
    COUNT(*) AS count_no_trans
FROM
    (
        SELECT
            t1.customer_id
        FROM
            Visits AS t1
            LEFT JOIN Transactions AS t2 ON t1.visit_id = t2.visit_id
        WHERE
            t2.transaction_id IS NULL
    ) AS t
GROUP BY
    customer_id;</code></pre></div>
<p>放在 WHERE 里：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    customer_id,
    COUNT(*) AS count_no_trans
FROM
    Visits
WHERE
    visit_id NOT IN(SELECT DISTINCT visit_id FROM Transactions)
GROUP BY
    customer_id;</code></pre></div>
<h3 id="文章浏览-i">1148. 文章浏览 I</h3>
<p>DISTINCT 去重。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT DISTINCT
    author_id AS id
FROM
    Views
WHERE
    author_id = viewer_id
ORDER BY
    id ASC;</code></pre></div>
<h3 id="上升的温度">197. 上升的温度</h3>
<p><code>ADDDATE</code> 函数的使用。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    today.id
FROM
    Weather AS yesterday,
    Weather AS today
WHERE
    today.recordDate = ADDDATE(yesterday.recordDate, INTERVAL 1 DAY)
    AND today.temperature &gt; yesterday.temperature;</code></pre></div>
<p>或者用 <code>DATE_ADD</code> 函数。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    today.id
FROM
    Weather AS yesterday,
    Weather AS today
WHERE
    today.recordDate = DATE_ADD(yesterday.recordDate, INTERVAL 1 DAY)
    AND today.temperature &gt; yesterday.temperature;</code></pre></div>
<h3 id="销售员">607. 销售员</h3>
<p>子查询。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    name
FROM
    SalesPerson
WHERE
    sales_id NOT IN (
        SELECT
            o.sales_id
        FROM
            Orders AS o
            INNER JOIN Company AS c ON o.com_id = c.com_id
        WHERE
            c.name = &#x27;RED&#x27;
    )</code></pre></div>
<h2 id="计算函数">计算函数</h2>
<h3 id="查询近30天活跃用户数">1141. 查询近30天活跃用户数</h3>
<p>这道题考察分组查询统计，首先 COUNT 里是可以用
<code>DISTINCT user_id</code> 来去重的，然后可以用 <code>DATE_SUB</code>
函数。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    activity_date AS day,
    COUNT(DISTINCT user_id) AS active_users
FROM
    Activity
WHERE
    activity_date &gt; DATE_SUB(&quot;2019-07-27&quot;, INTERVAL 30 DAY)
    AND activity_date &lt;= &quot;2019-07-27&quot;
GROUP BY
    activity_date;</code></pre></div>
<p>当然也可以用 <code>DATE_ADD</code> 函数。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    activity_date AS day,
    COUNT(DISTINCT user_id) AS active_users
FROM
    Activity
WHERE
    activity_date &gt; DATE_ADD(&quot;2019-07-27&quot;, INTERVAL -30 DAY)
    AND activity_date &lt;= &quot;2019-07-27&quot;
GROUP BY
    activity_date;</code></pre></div>
<h3 id="每天的领导和合伙人">1693. 每天的领导和合伙人</h3>
<p>这道题应该是考察 GOURP BY 可以按多列分组。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    date_id,
    make_name,
    COUNT(DISTINCT lead_id) AS unique_leads,
    COUNT(DISTINCT partner_id) AS unique_partners
FROM
    DailySales
GROUP BY
    date_id, make_name;</code></pre></div>
<h3 id="求关注者的数量">1729. 求关注者的数量</h3>
<p>其实就是对 <code>user_id</code> 进行 GROUP BY：</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    user_id,
    COUNT(*) AS followers_count
FROM
    Followers
GROUP BY
    user_id
ORDER BY
    user_id ASC;</code></pre></div>
<h3 id="订单最多的客户">586. 订单最多的客户</h3>
<p>首先找 <code>customer</code>
与其的订单数量，然后从中可以找到最多的订单数量，最后再查谁的订单数量等于最多的订单数量。嵌套子查询。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    MAX(order_count)
FROM(
    SELECT
        customer_number,
        COUNT(*) AS order_count
    FROM
        Orders
    GROUP BY
        customer_number
) AS t</code></pre></div>
<p>也可以直接用 <code>customer</code> 的订单数量从大到小排序，只输出 1
个值，只查 <code>customer_number</code> 。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    customer_number
FROM
    Orders
GROUP BY
    customer_number
ORDER BY
    count(*) DESC
LIMIT 1</code></pre></div>
<h3 id="游戏玩法分析-i">511. 游戏玩法分析 I</h3>
<p>直接用 GROUP BY 加 MIN 就行了。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    player_id,
    MIN(event_date) AS first_login
FROM
    Activity
GROUP BY
    player_id;</code></pre></div>
<h3 id="年最后一次登录">1890. 2020年最后一次登录</h3>
<p>这道题是 GROUP BY 加 MAX，比上道题多了个 WHERE 筛选年份。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    user_id,
    MAX(time_stamp) AS last_stamp
FROM
    Logins
WHERE
    time_stamp &gt;= DATE(&#x27;2020-01-01&#x27;)
    AND time_stamp &lt; DATE(&#x27;2021-01-01&#x27;)
GROUP BY
    user_id;</code></pre></div>
<p>也可以这样</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    user_id,
    MAX(time_stamp) AS last_stamp
FROM
    Logins
WHERE
    YEAR(time_stamp) = 2020
GROUP BY
    user_id;</code></pre></div>
<h3 id="查找每个员工花费的总时间">1741. 查找每个员工花费的总时间</h3>
<p>GROUP BY + SUM 函数，GROUP BY 是可以分组 2 列的。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    event_day AS day,
    emp_id,
    SUM(out_time-in_time) AS total_time
FROM
    Employees
GROUP BY
    event_day, emp_id</code></pre></div>
<h2 id="控制流">控制流</h2>
<h3 id="股票的资本损益">1393. 股票的资本损益</h3>
<p>收益等于每笔卖出减去买入的和，也就等于总卖出减去总买入，所以可以用
SUM 和 IF 。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    stock_name,
    SUM(IF(operation=&#x27;Sell&#x27;, price, 0))-SUM(IF(operation=&#x27;Buy&#x27;, price, 0)) AS capital_gain_loss
FROM
    Stocks
GROUP BY
    stock_name;</code></pre></div>
<p>当然可以把买入看作支出，卖出看作收入，那么两个 SUM IF
可以合并成一个。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    stock_name,
    SUM(IF(operation=&#x27;Sell&#x27;, price, -price))AS capital_gain_loss
FROM
    Stocks
GROUP BY
    stock_name;</code></pre></div>
<h3 id="排名靠前的旅行者">1407. 排名靠前的旅行者</h3>
<p>IFNULL 函数的使用，ORDER BY 的多列操作。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    t1.name,
    IFNULL(SUM(t2.distance), 0) AS travelled_distance
FROM
    Users AS t1
    LEFT JOIN Rides AS t2 ON t1.id = t2.user_id
GROUP BY
    t1.id
ORDER BY
    travelled_distance DESC, t1.name ASC;</code></pre></div>
<h3 id="市场分析-i">1158. 市场分析 I</h3>
<p>SUM IF YEAR 三个函数的使用，这题跟 Item 这张表没啥关系。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    t1.user_id AS buyer_id,
    t1.join_date,
    SUM(IF(YEAR(t2.order_date) = 2019, 1, 0)) AS orders_in_2019
FROM
    Users AS t1
    LEFT JOIN Orders AS t2 ON t1.user_id = t2.buyer_id
GROUP BY
    t1.user_id;</code></pre></div>
<p>还有种，<code>JOIN table ON condition</code> 后面居然可以用 AND
再加条件，是我没想到的。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    t1.user_id AS buyer_id,
    t1.join_date,
    COUNT(t2.buyer_id) AS orders_in_2019
FROM
    Users AS t1
    LEFT JOIN Orders AS t2 ON t1.user_id = t2.buyer_id AND YEAR(t2.order_date) = 2019
GROUP BY
    t1.user_id;</code></pre></div>
<p>而且在 ON 这里加跟在 WHERE 这里加不一样，如下图：</p>
<p>ON 添加条件限定 2019 年：</p>
<p><img
src="https://movis-blog.oss-cn-chengdu.aliyuncs.com/img/202212211008315.png" srcset="/img/loading.gif" lazyload /></p>
<p>WHERE 添加条件限定 2019 年：</p>
<p><img
src="https://movis-blog.oss-cn-chengdu.aliyuncs.com/img/202212211008555.png" srcset="/img/loading.gif" lazyload /></p>
<h3 id="查找重复的电子邮箱">182. 查找重复的电子邮箱</h3>
<p>GROUP BY + COUNT + HAVING 。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    Email
FROM
    Person
GROUP BY
    Email
HAVING
    COUNT(*) &gt; 1;</code></pre></div>
<h3 id="合作过至少三次的演员和导演">1050.
合作过至少三次的演员和导演</h3>
<p>依然是 GROUP BY + COUNT + HAVING 。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    actor_id,
    director_id
FROM
    ActorDirector
GROUP BY
    actor_id, director_id
HAVING
    COUNT(*)&gt;=3;</code></pre></div>
<h3 id="银行账户概要-ii">1587. 银行账户概要 II</h3>
<p>子查询 + GROUP BY + IFNULL + SUM 。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    name,
    balance
FROM(
    SELECT
        t1.name,
        IFNULL(SUM(t2.amount), 0) AS balance
    FROM
        Users AS t1
        LEFT JOIN Transactions AS t2 ON t1.account = t2.account
    GROUP BY
        t1.account
) AS t
WHERE
    balance &gt; 10000;</code></pre></div>
<p>当然直接用 GROUP BY + IFNULL + HAVING 也可以，因为 HAVING 针对的就是
GROUP BY 之后的结果。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT
    t1.name,
    IFNULL(SUM(t2.amount), 0) AS balance
FROM
    Users AS t1
    LEFT JOIN Transactions AS t2 ON t1.account = t2.account
GROUP BY
    t1.account
HAVING
    balance &gt; 10000;</code></pre></div>
<h3 id="销售分析iii">1084. 销售分析III</h3>
<p>可以用子查询 + 连接的方式，不过需要去重。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT DISTINCT
    t1.product_id,
    t1.product_name
FROM
    Product AS t1
    INNER JOIN Sales AS t2 ON t1.product_id = t2.product_id
WHERE
    t1.product_id NOT IN (
        SELECT product_id
        FROM Sales
        WHERE YEAR(sale_date) != 2019 OR MONTH(sale_date) &gt; 3
    );</code></pre></div>
<p>两个子查询也是可以的。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT DISTINCT
    product_id,
    product_name
FROM
    Product
WHERE
    product_id NOT IN (
        SELECT product_id
        FROM Sales
        WHERE YEAR(sale_date) != 2019 OR MONTH(sale_date) &gt; 3
    )
    AND product_id IN (
        SELECT DISTINCT product_id
        FROM Sales
    );</code></pre></div>
<p>当然可以在一个子查询里用 MAX + MIN 两个函数做控制。</p>
<div class="code-wrapper"><pre><code class="hljs mysql">SELECT DISTINCT
    product_id,
    product_name
FROM
    Product
WHERE
    product_id IN (
        SELECT product_id
        FROM Sales
        GROUP BY product_id
        HAVING MAX(sale_date) &lt;= &#x27;2019-03-31&#x27; AND MIN(sale_date) &gt;= &#x27;2019-01-01&#x27;
    );</code></pre></div>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/ComputerScience/" class="category-chain-item">ComputerScience</a>
  
  
    <span>></span>
    
  <a href="/categories/ComputerScience/Algorithm/" class="category-chain-item">Algorithm</a>
  
  
    <span>></span>
    
  <a href="/categories/ComputerScience/Algorithm/LeetCode/" class="category-chain-item">LeetCode</a>
  
  

  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/SQL/">#SQL</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>「SQL」 - 学习计划</div>
      <div>https://movisli.github.io/2022/12/22/leetcodeSQL/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>MovisLi</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>December 22, 2022</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>Licensed under</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/02/21/leetcode%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="「数据结构」 - 学习计划">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">「数据结构」 - 学习计划</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/12/08/leetcode20221208/" title="LeetCode 697 704">
                        <span class="hidden-mobile">LeetCode 697 704</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>
  </div>
</div>





  



  



  



  



  


  
  








    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>






  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        MathJax = {
          tex    : {
            inlineMath: { '[+]': [['$', '$']] }
          },
          loader : {
            load: ['ui/lazy']
          },
          options: {
            renderActions: {
              findScript    : [10, doc => {
                document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                  const display = !!node.type.match(/; *mode=display/);
                  const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                  const text = document.createTextNode('');
                  node.parentNode.replaceChild(text, node);
                  math.start = { node: text, delim: '', n: 0 };
                  math.end = { node: text, delim: '', n: 0 };
                  doc.math.push(math);
                });
              }, '', false],
              insertedScript: [200, () => {
                document.querySelectorAll('mjx-container').forEach(node => {
                  let target = node.parentNode;
                  if (target.nodeName.toLowerCase() === 'li') {
                    target.parentNode.classList.add('has-jax');
                  }
                });
              }, '', false]
            }
          }
        };
      </script>
    

  <script  src="https://unpkg.com/mathjax@3.2.0/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
